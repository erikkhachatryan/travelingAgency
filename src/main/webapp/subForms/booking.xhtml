<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <p:dialog id="bookingDialogId" widgetVar="bookingDialog" width="1000px"
              header="Book" height="500px" dynamic="true" modal="true" resizable="false">
        <p:ajax event="close" listener="#{bookingSubForm.closeAction}"/>
        <h:form id="bookingSubFormId">
            <h:panelGroup id="buttonsPanelGroupId" styleClass="right">
                <p:commandButton id="cancelButtonId"
                                 value="Cancel"
                                 process="@this"
                                 styleClass="cancelButton"
                                 style="background-color: #cfa402;"
                                 update="@this"
                                 actionListener="#{bookingSubForm.closeAction}"/>
                <p:commandButton id="bookingButtonId"
                                 binding="#{bookingButtonBinding}"
                                 value="Book"
                                 styleClass="saveButton"
                                 style="background-color: #1d9e04;"
                                 update="bookingSubFormId tripSubFormId travelingLocationSubFormId:locationTripsTableId"
                                 process="bookingSubFormId"
                                 actionListener="#{bookingSubForm.saveAction}"/>
            </h:panelGroup>

            <div style="clear: both"/>

            <h:panelGroup id="bookingDetailsPanelGroupId" layout="block">
                <h:panelGroup id="availableTicketsPanelGroupId" layout="block">
                    <p:outputLabel id="availableTicketsLabelId" value="Available Tickets: "/>
                    <h:outputText id="availableTicketsOutputTextId" value="#{bookingSubForm.parentForm.currentEntity.AvailableTickets}" />
                </h:panelGroup>
                <h:panelGroup id="ticketsCountPanelGroupId" layout="block" styleClass="inline-grid">
                    <p:outputLabel id="ticketsCountLabelId" value="Order Tickets Count: "/>
                    <p:inputText id="ticketsCountInputNumberId" type="number" value="#{bookingSubForm.currentEntity.TicketsCount}"
                                 converter="javax.faces.Integer" required="true">
                        <p:ajax process="@this" update="@this totalCostPanelGroupId" />
                    </p:inputText>
                    <p:message id="ticketsCountRequiredMessageId" for="ticketsCountInputNumberId" />
                </h:panelGroup>

                <p:message id="ticketsCountAvailabilityValidationMessageId" for="ticketsCountAvailabilityValidatorId"/>

                <h:inputHidden value="true" id="ticketsCountAvailabilityValidatorId">
                    <f:validator validatorId="ticketsAvailableValidator" for="ticketsCountAvailabilityValidatorId"/>
                    <f:attribute name="process" value="#{not empty param[bookingButtonBinding.clientId]}"/>
                    <f:attribute name="message" value="Only #{bookingSubForm.parentForm.currentEntity.AvailableTickets} tickets are available."/>
                    <f:attribute name="availableTicketsCount" value="#{bookingSubForm.parentForm.currentEntity.AvailableTickets}"/>
                    <f:attribute name="orderedTicketsCount" value="#{bookingSubForm.currentEntity.TicketsCount}"/>
                </h:inputHidden>

                <div style="clear: both"/>

                <h:panelGroup id="totalCostPanelGroupId" layout="block">
                    <p:outputLabel id="totalCostLabelId" value="Total Cost: "/>
                    <h:outputText id="totalCostOutputTextId" type="number" value="#{bookingSubForm.totalCost}" />
                </h:panelGroup>

                <div style="clear: both"/>

                <h:panelGroup id="tripDiagramPanelGroupId" layout="block">
                    <p:outputLabel id="tripCheckpointLabelId" value="Trip Checkpoints: "/>
                    <p:diagram value="#{bookingSubForm.parentForm.diagram}" style="height:300px" styleClass="ui-widget-content" />
                    <style type="text/css">
                        .ui-diagram-element {
                            width:10em;
                            height:6em;
                            line-height:5em;
                            text-align: center;
                            box-shadow: 0 5px 10px rgba(207, 101, 37, 0.8);
                            border-radius: 1em;
                            border: 1px solid #cf0c00;
                            background-color: #cfa402;
                            color: #ffffff;
                        }

                        .ui-diagram-element:hover {
                            background-color: #cf0c00;
                        }
                    </style>
                </h:panelGroup>
            </h:panelGroup>
            
        </h:form>
    </p:dialog>
</ui:composition>
